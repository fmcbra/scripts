#!/bin/bash

readonly LIB_PATH="$(cd $(dirname "$0")/..; pwd)/lib"
source "$LIB_PATH"/functions.bash || exit 1

function init()
{
  [[ -d .git ]] && die "/etc/.git exists"

  git init || die "git init failed"
  chmod 0700 .git || die "/etc/.git: chmod failed"

  git commit --allow-empty -m Initial\ commit || die "git commit failed"
  git add . || die "git add failed"
  git commit -m Initial\ import || die "git commit failed"
}

function add()       { [[ -d .git ]] || die "/etc/.git doesn't exist"; git add "$@"; }
function commit()    { [[ -d .git ]] || die "/etc/.git doesn't exist"; git commit "$@"; }
function checkout()  { [[ -d .git ]] || die "/etc/.git doesn't exist"; git checkout "$@"; }
function diff()      { [[ -d .git ]] || die "/etc/.git doesn't exist"; git diff "$@"; }
function gc()        { [[ -d .git ]] || die "/etc/.git doesn't exist"; git gc --aggressive "$@"; }
function log()       { [[ -d .git ]] || die "/etc/.git doesn't exist"; git log "$@"; }
function mv()        { [[ -d .git ]] || die "/etc/.git doesn't exist"; git mv "$@"; }
function rm()        { [[ -d .git ]] || die "/etc/.git doesn't exist"; git rm "$@"; }
function status()    { [[ -d .git ]] || die "/etc/.git doesn't exist"; git status "$@"; }
function submodule() { [[ -d .git ]] || die "/etc/.git doesn't exist"; git submodule "$@"; }
function tag()       { [[ -d .git ]] || die "/etc/.git doesn't exist"; git tag "$@"; }

cmd="$(basename "$0")"
cmd="${cmd#etc-git-}"
case "$cmd" in
  init|add|checkout|commit|diff|gc|log|mv|rm|submodule|status|tag|tig)
    cd /etc || die "/etc: cd(1) failed"
    $cmd "$@"
    exit $?
    ;;
  *)
    die "invalid command '$cmd'"
    ;;
esac

##
# vim: ts=2 sw=2 et fdm=marker :
##
